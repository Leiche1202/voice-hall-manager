# 语音厅管理系统 - 数据库设计文档

## 概述

本文档详细描述了语音厅管理系统的数据库设计，包括表结构、字段定义、关系模型和索引设计等内容。该数据库设计旨在支持系统的核心功能，包括用户管理、档表管理、工资管理等。

## 数据库选择

推荐使用腾讯云数据库 MySQL 5.7 或更高版本，具有以下优势：

- 高可用性和稳定性
- 自动备份和数据恢复
- 监控和告警功能
- 与腾讯云其他服务的良好集成

## 表结构设计

### 1. 用户表 (users)

存储系统用户信息，包括管理员和主持人。

```sql
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `password` varchar(255) NOT NULL COMMENT '密码（加密存储）',
  `real_name` varchar(50) DEFAULT NULL COMMENT '真实姓名',
  `role` enum('admin','host') NOT NULL COMMENT '角色：admin-厅管，host-主持人',
  `phone` varchar(20) DEFAULT NULL COMMENT '手机号',
  `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态：0-禁用，1-启用',
  `last_login_time` datetime DEFAULT NULL COMMENT '最后登录时间',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

### 2. 主持人信息表 (hosts)

存储主持人的详细信息。

```sql
CREATE TABLE `hosts` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL COMMENT '关联用户ID',
  `nickname` varchar(50) NOT NULL COMMENT '昵称',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像URL',
  `gender` enum('male','female','other') DEFAULT NULL COMMENT '性别',
  `birth_date` date DEFAULT NULL COMMENT '出生日期',
  `join_date` date NOT NULL COMMENT '入职日期',
  `level` int(11) NOT NULL DEFAULT '1' COMMENT '主持人等级',
  `experience` int(11) NOT NULL DEFAULT '0' COMMENT '经验值',
  `description` text DEFAULT NULL COMMENT '个人简介',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_user_id` (`user_id`),
  CONSTRAINT `fk_hosts_user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='主持人信息表';
```

### 3. 档表主表 (schedules)

存储档表的基本信息。

```sql
CREATE TABLE `schedules` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `date` date NOT NULL COMMENT '日期',
  `creator_id` int(11) NOT NULL COMMENT '创建者ID',
  `status` enum('draft','published','archived') NOT NULL DEFAULT 'draft' COMMENT '状态：draft-草稿，published-已发布，archived-已归档',
  `remark` varchar(255) DEFAULT NULL COMMENT '备注',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_date` (`date`),
  KEY `idx_creator_id` (`creator_id`),
  CONSTRAINT `fk_schedules_creator_id` FOREIGN KEY (`creator_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='档表主表';
```

### 4. 档表明细表 (schedule_details)

存储每小时的档表安排详情。

```sql
CREATE TABLE `schedule_details` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `schedule_id` int(11) NOT NULL COMMENT '关联档表ID',
  `hour` tinyint(2) NOT NULL COMMENT '小时（0-23）',
  `backup_host_id` int(11) DEFAULT NULL COMMENT '备档主持人ID',
  `main_host_id` int(11) DEFAULT NULL COMMENT '主档主持人ID',
  `accompany_host_id` int(11) DEFAULT NULL COMMENT '陪档主持人ID',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_schedule_hour` (`schedule_id`,`hour`),
  KEY `idx_backup_host_id` (`backup_host_id`),
  KEY `idx_main_host_id` (`main_host_id`),
  KEY `idx_accompany_host_id` (`accompany_host_id`),
  CONSTRAINT `fk_schedule_details_schedule_id` FOREIGN KEY (`schedule_id`) REFERENCES `schedules` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_schedule_details_backup_host_id` FOREIGN KEY (`backup_host_id`) REFERENCES `hosts` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_schedule_details_main_host_id` FOREIGN KEY (`main_host_id`) REFERENCES `hosts` (`id`) ON DELETE SET NULL,
  CONSTRAINT `fk_schedule_details_accompany_host_id` FOREIGN KEY (`accompany_host_id`) REFERENCES `hosts` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='档表明细表';
```

### 5. 接档记录表 (schedule_check_ins)

记录主持人接档情况。

```sql
CREATE TABLE `schedule_check_ins` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `schedule_detail_id` int(11) NOT NULL COMMENT '关联档表明细ID',
  `host_id` int(11) NOT NULL COMMENT '主持人ID',
  `role` enum('backup','main','accompany') NOT NULL COMMENT '角色：backup-备档，main-主档，accompany-陪档',
  `check_in_time` datetime DEFAULT NULL COMMENT '接档时间',
  `status` enum('pending','on_time','late','absent') NOT NULL DEFAULT 'pending' COMMENT '状态：pending-待接档，on_time-准时，late-迟到，absent-缺席',
  `remark` varchar(255) DEFAULT NULL COMMENT '备注',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_detail_host_role` (`schedule_detail_id`,`host_id`,`role`),
  KEY `idx_host_id` (`host_id`),
  CONSTRAINT `fk_schedule_check_ins_detail_id` FOREIGN KEY (`schedule_detail_id`) REFERENCES `schedule_details` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_schedule_check_ins_host_id` FOREIGN KEY (`host_id`) REFERENCES `hosts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='接档记录表';
```

### 6. 工资表 (salaries)

存储主持人工资信息。

```sql
CREATE TABLE `salaries` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `host_id` int(11) NOT NULL COMMENT '主持人ID',
  `year` int(4) NOT NULL COMMENT '年份',
  `month` int(2) NOT NULL COMMENT '月份',
  `base_salary` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '基本工资',
  `performance_salary` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '绩效工资',
  `bonus` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '奖金',
  `deduction` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '扣款',
  `total_salary` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '总工资',
  `status` enum('draft','confirmed','paid') NOT NULL DEFAULT 'draft' COMMENT '状态：draft-草稿，confirmed-已确认，paid-已发放',
  `remark` varchar(255) DEFAULT NULL COMMENT '备注',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_host_year_month` (`host_id`,`year`,`month`),
  CONSTRAINT `fk_salaries_host_id` FOREIGN KEY (`host_id`) REFERENCES `hosts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='工资表';
```

### 7. 工资明细表 (salary_details)

存储工资的详细计算项目。

```sql
CREATE TABLE `salary_details` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `salary_id` int(11) NOT NULL COMMENT '关联工资ID',
  `item_name` varchar(50) NOT NULL COMMENT '项目名称',
  `item_type` enum('income','deduction') NOT NULL COMMENT '类型：income-收入，deduction-扣除',
  `amount` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '金额',
  `description` varchar(255) DEFAULT NULL COMMENT '描述',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_salary_id` (`salary_id`),
  CONSTRAINT `fk_salary_details_salary_id` FOREIGN KEY (`salary_id`) REFERENCES `salaries` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='工资明细表';
```

### 8. 系统配置表 (system_configs)

存储系统配置信息。

```sql
CREATE TABLE `system_configs` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `config_key` varchar(50) NOT NULL COMMENT '配置键',
  `config_value` text NOT NULL COMMENT '配置值',
  `description` varchar(255) DEFAULT NULL COMMENT '描述',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_config_key` (`config_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统配置表';
```

### 9. 操作日志表 (operation_logs)

记录系统操作日志。

```sql
CREATE TABLE `operation_logs` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) DEFAULT NULL COMMENT '操作用户ID',
  `action` varchar(50) NOT NULL COMMENT '操作行为',
  `target_type` varchar(50) DEFAULT NULL COMMENT '目标类型',
  `target_id` int(11) DEFAULT NULL COMMENT '目标ID',
  `content` text DEFAULT NULL COMMENT '操作内容',
  `ip` varchar(50) DEFAULT NULL COMMENT 'IP地址',
  `user_agent` varchar(255) DEFAULT NULL COMMENT '用户代理',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_target` (`target_type`,`target_id`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `fk_operation_logs_user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作日志表';
```

## 初始数据

### 系统管理员账户

```sql
INSERT INTO `users` (`username`, `password`, `real_name`, `role`, `status`) VALUES
('admin', '$2a$10$X7tUdVJnXMPC7MuBM/K7p.RuZJ1s.dYfP5Xz5wP5.jI3r2I0J3Tfy', '系统管理员', 'admin', 1);
-- 密码为 111 的bcrypt加密值
```

### 测试主持人账户

```sql
INSERT INTO `users` (`username`, `password`, `real_name`, `role`, `status`) VALUES
('host1', '$2a$10$X7tUdVJnXMPC7MuBM/K7p.RuZJ1s.dYfP5Xz5wP5.jI3r2I0J3Tfy', '测试主持人', 'host', 1);

INSERT INTO `hosts` (`user_id`, `nickname`, `gender`, `join_date`, `level`) VALUES
(2, '小明', 'male', CURDATE(), 1);
```

### 系统配置

```sql
INSERT INTO `system_configs` (`config_key`, `config_value`, `description`) VALUES
('site_name', '语音厅管理系统', '站点名称'),
('backup_host_hourly_rate', '50', '备档主持人小时工资'),
('main_host_hourly_rate', '80', '主档主持人小时工资'),
('accompany_host_hourly_rate', '60', '陪档主持人小时工资');
```

## 数据库关系图

```
用户表(users) ←──┐
     ↑           │
     │           │
主持人表(hosts) ─┘
     ↑
     │
档表明细表(schedule_details) ── 档表主表(schedules)
     ↓
接档记录表(schedule_check_ins)

主持人表(hosts) ── 工资表(salaries) ── 工资明细表(salary_details)

用户表(users) ── 操作日志表(operation_logs)
```

## 索引设计说明

1. 主键索引：所有表都使用自增整数作为主键，提高插入性能和查询效率
2. 唯一索引：对需要唯一性约束的字段创建唯一索引，如用户名、档表日期等
3. 外键索引：所有外键字段都创建了索引，优化关联查询性能
4. 复合索引：对经常一起查询的字段创建复合索引，如档表明细的档表ID和小时

## 数据库维护建议

1. **定期备份**：配置腾讯云数据库的自动备份功能，建议每日备份
2. **性能监控**：启用腾讯云数据库的性能监控，关注慢查询和资源使用情况
3. **定期优化**：每月执行一次表优化和索引分析，保持数据库性能
4. **数据归档**：对历史数据（如6个月前的档表和工资记录）进行归档处理
5. **安全配置**：
   - 限制数据库访问IP
   - 使用强密码
   - 定期更新数据库版本
   - 最小权限原则配置数据库用户

## 扩展性考虑

1. 表设计预留了扩展字段，如备注、描述等
2. 使用枚举类型限定可选值，但保留了扩展空间
3. 系统配置表可灵活添加新的配置项，无需修改表结构
4. 所有表都包含创建时间和更新时间，便于数据追踪和分析

## 数据迁移策略

如需从其他系统迁移数据到本系统，建议按以下步骤进行：

1. 导出源系统数据为CSV或SQL格式
2. 编写数据转换脚本，将源数据映射到目标表结构
3. 先导入基础数据（用户、主持人信息）
4. 再导入关联数据（档表、工资记录等）
5. 验证数据完整性和一致性

## 结论

本数据库设计充分考虑了语音厅管理系统的功能需求和性能要求，采用规范化设计原则，确保数据的一致性和完整性。通过合理的表结构和索引设计，可以支持系统高效运行和未来功能扩展。

在腾讯云环境中部署时，建议选择适当规格的MySQL实例，并启用自动备份、监控和告警功能，确保数据库的安全性和可用性。