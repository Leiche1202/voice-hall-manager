# 语音厅管理系统 - 免费部署指南

本文档提供了将语音厅管理系统部署到免费平台的详细步骤和最佳实践，适合个人开发者或小型团队在预算有限的情况下使用。

## 目录

1. [准备工作](#准备工作)
2. [构建应用](#构建应用)
3. [前端部署方案](#前端部署方案)
4. [后端API部署方案](#后端api部署方案)
5. [数据库方案](#数据库方案)
6. [域名和HTTPS配置](#域名和https配置)
7. [持续集成/持续部署](#持续集成持续部署)
8. [监控和维护](#监控和维护)

## 准备工作

### 本地环境准备

1. 确保本地开发环境已完成开发和测试
2. 确保Git仓库已更新最新代码
3. 安装必要的CLI工具（如Vercel CLI、Netlify CLI等）

### 账号准备

1. 注册GitHub账号：https://github.com/
2. 根据选择的部署平台，注册相应账号：
   - Vercel: https://vercel.com/
   - Netlify: https://www.netlify.com/
   - GitHub Pages (使用GitHub账号)
3. 根据选择的数据库服务，注册相应账号：
   - Firebase: https://firebase.google.com/
   - MongoDB Atlas: https://www.mongodb.com/cloud/atlas
   - Supabase: https://supabase.com/

## 构建应用

在部署前，需要先构建生产环境的应用包：

```bash
# 安装依赖
npm install

# 构建生产环境应用
npm run build
```

构建完成后，会在`dist`目录生成可部署的静态文件。

## 前端部署方案

### 方案1：Vercel（推荐）

Vercel提供永久免费计划，支持React应用部署，并自动配置HTTPS。

1. 安装Vercel CLI

```bash
npm install -g vercel
```

2. 登录Vercel

```bash
vercel login
```

3. 部署应用

```bash
# 在项目根目录执行
vercel
```

4. 按照提示完成配置，首次部署会要求设置项目名称、构建命令等

5. 部署完成后，Vercel会提供一个域名（如`your-app.vercel.app`）

### 方案2：Netlify

Netlify也提供永久免费计划，支持自动部署和HTTPS。

1. 安装Netlify CLI

```bash
npm install -g netlify-cli
```

2. 登录Netlify

```bash
netlify login
```

3. 部署应用

```bash
# 构建应用
npm run build

# 部署dist目录
netlify deploy --dir=dist
```

4. 确认部署无误后，执行正式部署

```bash
netlify deploy --dir=dist --prod
```

### 方案3：GitHub Pages

GitHub Pages完全免费，适合静态网站托管。

1. 在GitHub创建一个新仓库

2. 在项目中添加`vite.config.js`的base配置（如果仓库名不是根路径）

```javascript
export default defineConfig({
  base: '/your-repo-name/',
  // 其他配置...
})
```

3. 创建部署脚本，在项目根目录创建`deploy.sh`文件

```bash
#!/usr/bin/env sh

# 发生错误时终止
set -e

# 构建
npm run build

# 进入构建文件夹
cd dist

# 如果你要部署到自定义域名
# echo 'www.example.com' > CNAME

git init
git add -A
git commit -m 'deploy'

# 如果你要部署在 https://<USERNAME>.github.io
# git push -f git@github.com:<USERNAME>/<USERNAME>.github.io.git main

# 如果你要部署在 https://<USERNAME>.github.io/<REPO>
git push -f git@github.com:<USERNAME>/<REPO>.git main:gh-pages

cd -
```

4. 执行部署脚本

```bash
sh deploy.sh
```

5. 在GitHub仓库设置中启用GitHub Pages，选择gh-pages分支作为源

## 后端API部署方案

### 方案1：Vercel Serverless Functions

Vercel不仅可以部署前端，还支持Serverless Functions作为后端API。

1. 在项目根目录创建`api`文件夹

2. 在`api`文件夹中创建API端点，例如`api/auth.js`：

```javascript
export default function handler(req, res) {
  if (req.method === 'POST') {
    // 处理登录逻辑
    const { username, password } = req.body;
    
    // 模拟验证
    if (username === '1' && password === '111') {
      res.status(200).json({
        code: 200,
        message: '登录成功',
        data: {
          token: 'mock-token',
          user: {
            id: 1,
            username: '1',
            role: 'admin'
          }
        }
      });
    } else {
      res.status(401).json({
        code: 401,
        message: '用户名或密码错误'
      });
    }
  } else {
    res.status(405).json({ message: 'Method Not Allowed' });
  }
}
```

3. 部署到Vercel时，这些API端点会自动作为Serverless Functions部署

### 方案2：Netlify Functions

Netlify也提供类似的Serverless Functions功能。

1. 在项目根目录创建`netlify.toml`文件

```toml
[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"
```

2. 创建`netlify/functions`目录，并添加函数文件，如`auth.js`：

```javascript
exports.handler = async function(event, context) {
  if (event.httpMethod !== 'POST') {
    return { statusCode: 405, body: JSON.stringify({ message: 'Method Not Allowed' }) };
  }
  
  try {
    const { username, password } = JSON.parse(event.body);
    
    // 模拟验证
    if (username === '1' && password === '111') {
      return {
        statusCode: 200,
        body: JSON.stringify({
          code: 200,
          message: '登录成功',
          data: {
            token: 'mock-token',
            user: {
              id: 1,
              username: '1',
              role: 'admin'
            }
          }
        })
      };
    } else {
      return {
        statusCode: 401,
        body: JSON.stringify({
          code: 401,
          message: '用户名或密码错误'
        })
      };
    }
  } catch (error) {
    return { statusCode: 500, body: JSON.stringify({ message: error.toString() }) };
  }
};
```

## 数据库方案

### 方案1：Firebase Firestore

Firebase提供免费的NoSQL数据库服务，适合中小型应用。

1. 创建Firebase项目

2. 启用Firestore数据库

3. 安装Firebase SDK

```bash
npm install firebase
```

4. 配置Firebase

```javascript
// src/lib/firebase.js
import { initializeApp } from 'firebase/app';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

export { db };
```

5. 使用Firestore进行数据操作

```javascript
import { collection, addDoc, getDocs, query, where } from 'firebase/firestore';
import { db } from '../lib/firebase';

// 添加档表
async function addSchedule(scheduleData) {
  try {
    const docRef = await addDoc(collection(db, "schedules"), scheduleData);
    return docRef.id;
  } catch (error) {
    console.error("Error adding document: ", error);
    throw error;
  }
}

// 查询档表
async function getSchedulesByDate(date) {
  try {
    const q = query(collection(db, "schedules"), where("date", "==", date));
    const querySnapshot = await getDocs(q);
    const schedules = [];
    querySnapshot.forEach((doc) => {
      schedules.push({ id: doc.id, ...doc.data() });
    });
    return schedules;
  } catch (error) {
    console.error("Error getting documents: ", error);
    throw error;
  }
}
```

### 方案2：MongoDB Atlas

MongoDB Atlas提供免费的云数据库服务，支持512MB存储空间。

1. 注册MongoDB Atlas账号并创建免费集群

2. 创建数据库用户和设置IP访问白名单

3. 获取连接字符串

4. 如果使用Vercel或Netlify，可以在环境变量中设置连接字符串

### 方案3：本地存储 + IndexedDB

对于简单应用或原型，可以使用浏览器的IndexedDB作为本地数据库。

1. 安装idb库简化IndexedDB操作

```bash
npm install idb
```

2. 配置和使用IndexedDB

```javascript
// src/lib/db.js
import { openDB } from 'idb';

const dbPromise = openDB('voice-hall-db', 1, {
  upgrade(db) {
    // 创建用户表
    if (!db.objectStoreNames.contains('users')) {
      db.createObjectStore('users', { keyPath: 'id', autoIncrement: true });
    }
    // 创建档表
    if (!db.objectStoreNames.contains('schedules')) {
      const scheduleStore = db.createObjectStore('schedules', { keyPath: 'id', autoIncrement: true });
      scheduleStore.createIndex('date', 'date', { unique: true });
    }
  },
});

export async function addUser(user) {
  return (await dbPromise).add('users', user);
}

export async function getUsers() {
  return (await dbPromise).getAll('users');
}

export async function addSchedule(schedule) {
  return (await dbPromise).add('schedules', schedule);
}

export async function getScheduleByDate(date) {
  const db = await dbPromise;
  const tx = db.transaction('schedules', 'readonly');
  const index = tx.store.index('date');
  return index.get(date);
}
```

## 域名和HTTPS配置

### 免费域名方案

1. 使用部署平台提供的子域名（如`your-app.vercel.app`）
2. 使用Freenom提供的免费顶级域名（如`.tk`, `.ml`, `.ga`等）

### HTTPS配置

- Vercel、Netlify和GitHub Pages默认提供HTTPS支持
- 如果使用自定义域名，这些平台也会自动为您的域名配置SSL证书

## 持续集成/持续部署

### GitHub Actions + GitHub Pages

1. 在项目根目录创建`.github/workflows/deploy.yml`文件

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    
    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'
        
    - name: Install Dependencies
      run: npm install
      
    - name: Build
      run: npm run build
      
    - name: Deploy to GitHub Pages
      uses: JamesIves/github-pages-deploy-action@4.1.4
      with:
        branch: gh-pages
        folder: dist
```

### Vercel GitHub集成

1. 在Vercel导入GitHub仓库
2. 配置构建设置
3. Vercel会自动监听代码变更并部署

### Netlify GitHub集成

1. 在Netlify导入GitHub仓库
2. 配置构建设置
3. Netlify会自动监听代码变更并部署

## 监控和维护

### 免费监控工具

1. **Vercel Analytics**：Vercel提供基本的访问分析
2. **Google Analytics**：免费的网站访问分析工具
3. **Sentry**：提供免费计划的错误跟踪工具

### 日志管理

- 使用浏览器控制台记录前端日志
- 使用Vercel或Netlify提供的函数日志查看后端日志

### 性能优化

1. 使用代码分割减小初始加载大小

```javascript
// 在路由配置中使用React.lazy
import React, { lazy, Suspense } from 'react';

const LoginPage = lazy(() => import('./pages/LoginPage'));
const Dashboard = lazy(() => import('./pages/Dashboard'));

function App() {
  return (
    <Router>
      <Suspense fallback={<div>Loading...</div>}>
        <Routes>
          <Route path="/" element={<LoginPage />} />
          <Route path="/dashboard" element={<Dashboard />} />
        </Routes>
      </Suspense>
    </Router>
  );
}
```

2. 使用CDN加速静态资源
   - Vercel和Netlify默认提供CDN加速
   - 对于GitHub Pages，可以考虑使用Cloudflare免费CDN

## 总结

按照本指南完成部署后，您的语音厅管理系统将在免费平台上稳定运行。系统采用了现代化的前端框架React，使用Serverless Functions作为后端API，以及免费的数据库服务存储数据。

这种部署方案适合个人开发者、小型团队或初创项目，可以在不产生基础设施成本的情况下快速上线和验证产品。随着项目的发展和用户量的增长，您可以根据需要逐步升级到付费服务或自建基础设施。

## 注意事项

1. 免费服务通常有使用限制，如API调用次数、存储空间、带宽等
2. 某些免费服务在中国大陆访问可能较慢，需要考虑用户体验
3. 对于正式生产环境，建议评估付费服务以获得更好的性能和可靠性
4. 定期备份数据，避免数据丢失
5. 关注服务提供商的政策变更，以免影响系统运行